#include "origamielephant.h"

using namespace std;

storage_p decrypt_origami_c2(storage_p enc, storage_p key) {
  size_t decoded_len;
  unsigned char decoded[enc->size()*3/4];
  storage_p decrypted_p;

  //TODO try to get decoded len first, not truncate in append
  mbedtls_base64_decode(decoded, enc->size(), &decoded_len,
						reinterpret_cast<const unsigned char *>(enc->data()), enc->size());
  decrypted_p = build_storage_bin(decoded, decoded_len);
  dexor(decrypted_p, key, key->size());
  return decrypted_p;
}